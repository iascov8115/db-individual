# Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸

Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾ÑÑ‚Ð¾Ð¸Ñ‚ Ð¸Ð· Ñ‚Ñ€Ñ‘Ñ… ÑÑ‚Ñ€Ð°Ð½Ð¾Ð²Ñ‹Ñ… ÑƒÐ·Ð»Ð¾Ð²:

- **Moldova** â€” Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑƒÐ·ÐµÐ» (Ð³Ð»Ð°Ð²Ð½Ð°Ñ Ð‘Ð” + ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ð¾Ñ€ ÑˆÐ°Ñ€Ð´Ð¸Ð½Ð³Ð° + Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸Ðº ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸ÐºÐ¾Ð²).
- **Romania** â€” ÑˆÐ°Ñ€Ð´ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²/ÑÐºÐ»Ð°Ð´Ð¾Ð² Ð´Ð»Ñ Ð ÑƒÐ¼Ñ‹Ð½Ð¸Ð¸.
- **Bulgaria** â€” ÑˆÐ°Ñ€Ð´ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²/ÑÐºÐ»Ð°Ð´Ð¾Ð² Ð´Ð»Ñ Ð‘Ð¾Ð»Ð³Ð°Ñ€Ð¸Ð¸.

ÐšÐ°Ð¶Ð´Ð°Ñ ÑÑ‚Ñ€Ð°Ð½Ð° Ð¸Ð¼ÐµÐµÑ‚ **primary + physical replica**.

Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ **Moldova primary** Ð¿ÑƒÐ±Ð»Ð¸ÐºÑƒÐµÑ‚ ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ‡ÐµÑ€ÐµÐ· **logical replication
**, Ð° ÑƒÐ·Ð»Ñ‹ Ð ÑƒÐ¼Ñ‹Ð½Ð¸Ð¸ Ð¸ Ð‘Ð¾Ð»Ð³Ð°Ñ€Ð¸Ð¸ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑ‹Ð²Ð°ÑŽÑ‚ÑÑ Ð½Ð° Ð½ÐµÑ‘.

---

# ðŸ”µ 1. Physical replication (Streaming replication)

## Ð§Ñ‚Ð¾ Ð¸Ð¼ÐµÐ½Ð½Ð¾ Ñ€ÐµÐ¿Ð»Ð¸Ñ†Ð¸Ñ€ÑƒÐµÑ‚ÑÑ

ÐšÐ°Ð¶Ð´Ð°Ñ ÑÑ‚Ñ€Ð°Ð½Ð° Ð¸Ð¼ÐµÐµÑ‚ ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ ÐºÐ»Ð°ÑÑ‚ÐµÑ€:

- **db_moldova** â†’ **db_moldova_replica**
- **db_romania** â†’ **db_romania_replica**
- **db_bulgaria** â†’ **db_bulgaria_replica**

Ð­Ñ‚Ð¾ Ð¾Ð±Ñ‹Ñ‡Ð½Ð°Ñ **Ð¿Ð¾Ñ‚Ð¾ÐºÐ¾Ð²Ð°Ñ Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ WAL (streaming replication)**.

## Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚ Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ

- Ð ÐµÐ¿Ð»Ð¸ÐºÐ° â€” **Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð¿Ð¾Ð±Ð°Ð¹Ñ‚Ð½Ñ‹Ð¹ ÑÐ»ÐµÐ¿Ð¾Ðº primary**.
- Ð’ÑÐµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð¿ÐµÑ€ÐµÐ´Ð°ÑŽÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· **WAL**.
- Ð ÐµÐ¿Ð»Ð¸ÐºÐ° read-only, Ð½Ðµ Ð¸Ð¼ÐµÐµÑ‚ ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ….
- ÐŸÑ€Ð¸ Ð¿Ð°Ð´ÐµÐ½Ð¸Ð¸ primary Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ **promote** â†’ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ° ÑÑ‚Ð°Ð½ÐµÑ‚ Ð¿Ð¾Ð»Ð½Ð¾Ñ†ÐµÐ½Ð½Ñ‹Ð¼ master.

## Ð”Ð»Ñ Ñ‡ÐµÐ³Ð¾ Ð¾Ð½Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ

- **High Availability**: Ð¾Ñ‚ÐºÐ°Ð·Ð¾ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ð¾ÑÑ‚ÑŒ, Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð³Ð¾ failover.
- **Load Balancing**: Ñ‚ÑÐ¶ÐµÐ»Ñ‹Ðµ SELECT Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ð½Ð° Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ¸.
- **Ð ÐµÐ³Ð¸Ð¾Ð½Ñ‹ Ð¸Ð·Ð¾Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ñ‹**: ÑÐ±Ð¾Ð¹ Ð½Ð° Ð‘Ð¾Ð»Ð³Ð°Ñ€Ð¸Ð¸ Ð½Ðµ Ð·Ð°Ñ‚Ñ€Ð¾Ð½ÐµÑ‚ Ð ÑƒÐ¼Ñ‹Ð½Ð¸ÑŽ.

## ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð° Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸

- ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ, Ð±Ñ‹ÑÑ‚Ñ€Ð°Ñ, Ð¿Ð¾Ñ‡Ñ‚Ð¸ Ð½Ðµ Ð´Ð°Ñ‘Ñ‚ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸.
- Ð’ÑÐµÐ³Ð´Ð° Ñ‚Ð¾Ñ‡Ð½Ð°Ñ ÐºÐ¾Ð¿Ð¸Ñ primary, Ð²ÐºÐ»ÑŽÑ‡Ð°Ñ Ð²Ð½ÑƒÑ‚Ñ€ÐµÐ½Ð½Ð¸Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹.
- ÐžÑ‚Ð»Ð¸Ñ‡Ð½Ð¾ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ Ð¾Ñ‚ÐºÐ°Ð·Ð¾ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ð¾ÑÑ‚Ð¸ Ð¸ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ‡Ñ‚ÐµÐ½Ð¸Ð¹.

---

# ðŸŸ¢ 2. Logical replication (Publication â†’ Subscriptions)

## Ð“Ð´Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ

**Ð¢Ð¾Ð»ÑŒÐºÐ¾ Ð½Ð° Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð¾Ð¼ ÑƒÐ·Ð»Ðµ (Moldova)**:

- `db_moldova_primary` ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ publication:
- `db_romania_primary` Ð¸ `db_bulgaria_primary` ÑÐ¾Ð·Ð´Ð°ÑŽÑ‚ subscriptions:

## Ð§Ñ‚Ð¾ Ñ€ÐµÐ¿Ð»Ð¸Ñ†Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¸

**Ð¡Ð¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ñ‹Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹:**

- regions
- product_categories
- products  
  (+ Ð»ÑŽÐ±Ñ‹Ðµ Ð´Ñ€ÑƒÐ³Ð¸Ðµ, ÐµÑÐ»Ð¸ Ñ‚Ñ‹ Ð·Ð°Ñ…Ð¾Ñ‡ÐµÑˆÑŒ)

## ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ð¾

Ð¢.Ðº. ÑÑ‚Ð¾ **ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸ÐºÐ¸**:

- Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÑŽÑ‚ÑÑ Ñ€ÐµÐ´ÐºÐ¾,
- Ð½ÑƒÐ¶Ð½Ñ‹ Ð¾Ð´Ð¸Ð½Ð°ÐºÐ¾Ð²Ñ‹Ð¼Ð¸ Ð²Ð¾ Ð²ÑÐµÑ… ÑÑ‚Ñ€Ð°Ð½Ð°Ñ…,
- Ð½Ðµ Ð·Ð°Ð²Ð¸ÑÑÑ‚ Ð¾Ñ‚ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ ÑˆÐ°Ñ€Ð´Ð°,
- Ð½Ð¾ Ð¿Ñ€Ð¸ ÑÑ‚Ð¾Ð¼ **Ð½Ðµ Ñ…Ð¾Ñ‡ÐµÑ‚ÑÑ Ñ€ÐµÐ¿Ð»Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð²ÐµÑÑŒ ÐºÐ»Ð°ÑÑ‚ÐµÑ€ ÐœÐ¾Ð»Ð´Ð¾Ð²Ñ‹ Ð² Ð ÑƒÐ¼Ñ‹Ð½Ð¸ÑŽ/Ð‘Ð¾Ð»Ð³Ð°Ñ€Ð¸ÑŽ**.

Ð›Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½ÑƒÐ¶Ð½Ñ‹Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹, Ð° Ð½Ðµ Ð²ÐµÑÑŒ Ð¸Ð½ÑÑ‚Ð°Ð½Ñ.

## Ð§Ñ‚Ð¾ Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ Ñ€ÐµÑˆÐ°ÐµÑ‚

- Ð’ÑÐµ ÑÑ‚Ñ€Ð°Ð½Ñ‹ Ð²ÑÐµÐ³Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ **Ð¾Ð´Ð¸Ð½Ð°ÐºÐ¾Ð²Ñ‹Ðµ ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸ÐºÐ¸**.
- ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð´ÐµÐ»Ð°ÑŽÑ‚ÑÑ **Ð² Ð¾Ð´Ð½Ð¾Ð¼ Ð¼ÐµÑÑ‚Ðµ** (ÐœÐ¾Ð»Ð´Ð¾Ð²Ð° â†’ publisher).
- Ð£ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑˆÐ°Ñ€Ð´Ð° ÐµÑÑ‚ÑŒ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð°Ñ ÐºÐ¾Ð¿Ð¸Ñ ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸ÐºÐ¾Ð² â†’ **Ð±Ñ‹ÑÑ‚Ñ€Ñ‹Ðµ JOIN'Ñ‹** Ð±ÐµÐ· ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… Ð·Ð°Ð´ÐµÑ€Ð¶ÐµÐº.
- ÐÐµ Ð½ÑƒÐ¶Ð½Ð¾ Ð³Ð¾Ñ€Ð¾Ð´Ð¸Ñ‚ÑŒ ÐºÑ€Ð¾ÑÑ-ÑˆÐ°Ñ€Ð´Ð¾Ð²Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð¸Ð»Ð¸ FDW Ð´Ð»Ñ ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ñ‹Ñ… Ñ‚Ð°Ð±Ð»Ð¸Ñ†.

---

# ðŸŸ£ 3. Ð“Ð¾Ñ€Ð¸Ð·Ð¾Ð½Ñ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑˆÐ°Ñ€Ð´Ð¸Ð½Ð³ Ð¿Ð¾ ÑÑ‚Ñ€Ð°Ð½Ð°Ð¼ (Ñ‡ÐµÑ€ÐµÐ· FDW + routing trigger)

ÐÐ° `db_moldova_primary`:

- Ð¡Ð¾Ð·Ð´Ð°Ð½Ñ‹ FDW ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ Ðº:
    - `db_romania_primary`,
    - `db_bulgaria_primary`.

- Ð¡Ð¾Ð·Ð´Ð°Ð½Ñ‹ foreign tables:
    - `orders_romania`
    - `orders_bulgaria`

- Ð¡Ð¾Ð·Ð´Ð°Ð½ **routing-Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€** Ð½Ð° `orders_distributed`, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¿Ð¾ Ñ€ÐµÐ³Ð¸Ð¾Ð½Ñƒ:
    - Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ INSERT Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ð¹ ÑˆÐ°Ñ€Ð´ (Ð ÑƒÐ¼Ñ‹Ð½Ð¸Ñ / Ð‘Ð¾Ð»Ð³Ð°Ñ€Ð¸Ñ / ÐœÐ¾Ð»Ð´Ð¾Ð²Ð°).

## Ð˜Ñ‚Ð¾Ð³

ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ð»ÑÑ Ð½Ð°ÑÑ‚Ð¾ÑÑ‰Ð¸Ð¹ **multishard cluster**:

- ÐµÐ´Ð¸Ð½Ð°Ñ Ñ‚Ð¾Ñ‡ÐºÐ° Ð²Ñ…Ð¾Ð´Ð° â€” ÐœÐ¾Ð»Ð´Ð¾Ð²Ð°,
- Ð´Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²,
- Ñ€Ð°ÑÐ¿Ñ€ÐµÐ´ÐµÐ»Ñ‘Ð½Ð½Ñ‹Ðµ Ð·Ð°ÐºÐ°Ð·Ñ‹ Ð¿Ð¾ ÑÑ‚Ñ€Ð°Ð½Ð°Ð¼,
- Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸ÐºÐ¸ (Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ),
- Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð°Ñ Ð¾Ñ‚ÐºÐ°Ð·Ð¾ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ð¾ÑÑ‚ÑŒ (Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ).

---

# ðŸŽ¯ Ð“Ð»Ð°Ð²Ð½Ñ‹Ðµ Ð¿Ñ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð° Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹

## 1. **ÐÐµÑ‚ ÐµÐ´Ð¸Ð½Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð¾Ñ‚ÐºÐ°Ð·Ð°**

Moldova Ð¸Ð¼ÐµÐµÑ‚ ÑÐ²Ð¾ÑŽ Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÑƒÑŽ Ñ€ÐµÐ¿Ð»Ð¸ÐºÑƒ.  
Romania Ð¸ Bulgaria â€” Ñ‚Ð¾Ð¶Ðµ.

Ð’ÑÐµ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÑƒÐ·Ð»Ñ‹ Ð¸Ð¼ÐµÑŽÑ‚ Ñ€ÐµÐ·ÐµÑ€Ð².

---

## 2. **Ð“Ð¸Ð±ÐºÐ°Ñ Ð¸ Ð±Ñ‹ÑÑ‚Ñ€Ð°Ñ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾ Ð³ÐµÐ¾Ð³Ñ€Ð°Ñ„Ð¸Ð¸**

Ð’ÑÑ‚Ð°Ð²ÐºÐ° Ð·Ð°ÐºÐ°Ð·Ð° Ð½Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ ÑÑ‚Ñ€Ð°Ð½Ñ‹:

```
INSERT INTO orders_distributed (...)
```

Ð Ñ‚Ñ€Ð¸Ð³Ð³ÐµÑ€ ÑÐ°Ð¼ Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ‚ÑƒÐ´Ð°, ÐºÑƒÐ´Ð° Ð½ÑƒÐ¶Ð½Ð¾:

- Ð ÑƒÐ¼Ñ‹Ð½Ð¸Ñ â†’ db_romania_primary
- Ð‘Ð¾Ð»Ð³Ð°Ñ€Ð¸Ñ â†’ db_bulgaria_primary
- ÐœÐ¾Ð»Ð´Ð¾Ð²Ð° â†’ db_moldova_primary

---

## 3. **Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸ÐºÐ¸ Ñ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¾Ð¹ ÐºÐ¾Ð½ÑÐ¸ÑÑ‚ÐµÐ½Ñ‚Ð½Ð¾ÑÑ‚ÑŒÑŽ**

Ð‘Ð»Ð°Ð³Ð¾Ð´Ð°Ñ€Ñ Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸:

- ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸ÐºÐ¸ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÑŽÑ‚ÑÑ Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð¾,
- Ð½Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾,
- Ð¸ Ð½Ðµ Ð½Ð°Ð³Ñ€ÑƒÐ¶Ð°ÑŽÑ‚ Ð´Ñ€ÑƒÐ³Ð¸Ðµ ÑƒÐ·Ð»Ñ‹.

Ð­Ñ‚Ð¾ **Ð¸Ð´ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐµÐ¹Ñ Ð´Ð»Ñ Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸**.

---

## 4. **Ð¨Ð°Ñ€Ð´Ñ‹ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ñ‹**

ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° Â«Ð² Ð ÑƒÐ¼Ñ‹Ð½Ð¸Ð¸ ÑƒÐ¿Ð°Ð» ÐºÐ»Ð°ÑÑ‚ÐµÑ€ â€” Ð‘Ð¾Ð»Ð³Ð°Ñ€Ð¸Ñ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÑÑ‚ÑŒ Ð·Ð°ÐºÐ°Ð·Ñ‹Â» Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚.  
ÐšÐ°Ð¶Ð´Ð°Ñ ÑÑ‚Ñ€Ð°Ð½Ð° Ð¶Ð¸Ð²Ñ‘Ñ‚ ÑÐ²Ð¾ÐµÐ¹ Ð¶Ð¸Ð·Ð½ÑŒÑŽ.

---

## 5. **ÐœÐ°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ**

ÐŸÑ€Ð¸ Ñ€Ð¾ÑÑ‚Ðµ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð¼Ð¾Ð¶Ð½Ð¾:

- Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ðµ ÑÑ‚Ñ€Ð°Ð½Ñ‹ â†’ Ð½Ð¾Ð²Ñ‹Ðµ ÑˆÐ°Ñ€Ð´Ñ‹,
- ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ñ€ÐµÐ¿Ð»Ð¸Ðº Ð½Ð° ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑˆÐ°Ñ€Ð´,
- Ð²Ñ‹Ð½ÐµÑÑ‚Ð¸ Ð½ÐµÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð½Ð° Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ¸,
- Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð°Ð¿Ð¿Ð°Ñ€Ð°Ñ‚Ð½Ð¾ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾.

---

## 6. **ÐÐ¸Ð·ÐºÐ¸Ðµ ÑÐµÑ‚ÐµÐ²Ñ‹Ðµ Ð·Ð°Ð´ÐµÑ€Ð¶ÐºÐ¸**

Ð’Ð½ÑƒÑ‚Ñ€Ð¸ ÑÑ‚Ñ€Ð°Ð½Ñ‹ Ð²ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¶Ð¸Ð²ÑƒÑ‚ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾:

- ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñ‹ Ð ÑƒÐ¼Ñ‹Ð½Ð¸Ð¸ â†’ Ð¼Ð°Ð³Ð°Ð·Ð¸Ð½ Ð ÑƒÐ¼Ñ‹Ð½Ð¸Ð¸,
- ÑÐºÐ»Ð°Ð´Ñ‹ Ð ÑƒÐ¼Ñ‹Ð½Ð¸Ð¸ â†’ Ð·Ð°ÐºÐ°Ð·Ñ‹ Ð ÑƒÐ¼Ñ‹Ð½Ð¸Ð¸.

Ð­Ñ‚Ð¾ Ð²Ð°Ð¶Ð½Ð¾ Ð² Ð»Ð¾Ð³Ð¸ÑÑ‚Ð¸ÐºÐµ Ð¸ e-commerce.

---

## 7. **Ð£Ð´Ð¾Ð±ÑÑ‚Ð²Ð¾ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ**

- Ñ„Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ â€œÐ¼Ð°Ð³Ð¸Ñ‡ÐµÑÐºÐ¸â€ Ð¸ Ð¿Ð¾Ñ‡Ñ‚Ð¸ Ð½Ðµ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ñ;
- Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¾Ñ‡ÐµÐ½ÑŒ Ð¿Ñ€Ð¾ÑÑ‚Ð° (Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ‚Ð°Ð±Ð»Ð¸Ñ†);
- Ð½ÐµÑ‚ Ñ‚ÑÐ¶Ñ‘Ð»Ñ‹Ñ… Ð¸ Ñ…Ñ€ÑƒÐ¿ÐºÐ¸Ñ… ÐºÑ€Ð¾ÑÑ-ÑˆÐ°Ñ€Ð´Ð¾Ð²Ñ‹Ñ… ÑÐ²ÑÐ·ÐµÐ¹.

---

# ðŸ§© ÐšÑ€Ð°Ñ‚ÐºÐ°Ñ Ð¸Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²ÐºÐ° (Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð² Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸)

**ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ Ð´Ð²ÑƒÑ…ÑƒÑ€Ð¾Ð²Ð½ÐµÐ²ÑƒÑŽ Ð¼Ð¾Ð´ÐµÐ»ÑŒ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸:**

1. **Ð¤Ð¸Ð·Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ
   ** (streaming replication) Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð¾Ñ‚ÐºÐ°Ð·Ð¾ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ð¾ÑÑ‚ÑŒ Ð¸ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ‡Ñ‚ÐµÐ½Ð¸Ð¹ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ ÑÑ‚Ñ€Ð°Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑƒÐ·Ð»Ð° (primary â†’ standby).
2. **Ð›Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ
   ** Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ñ€Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸Ð· Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑƒÐ·Ð»Ð° (ÐœÐ¾Ð»Ð´Ð¾Ð²Ð°) Ð½Ð° ÑÑ‚Ñ€Ð°Ð½Ð¾Ð²Ñ‹Ðµ ÑˆÐ°Ñ€Ð´Ñ‹ (Ð ÑƒÐ¼Ñ‹Ð½Ð¸Ñ Ð¸ Ð‘Ð¾Ð»Ð³Ð°Ñ€Ð¸Ñ), Ñ‡Ñ‚Ð¾ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ ÐµÐ´Ð¸Ð½Ð¾Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ ÑÐ¿Ñ€Ð°Ð²Ð¾Ñ‡Ð½Ð¸ÐºÐ¾Ð², Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½ÑƒÑŽ Ð½Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð¸ Ð²Ñ‹ÑÐ¾ÐºÑƒÑŽ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½ÑƒÑŽ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ñ….

Ð¢Ð°ÐºÐ¾Ðµ ÑÐ¾Ñ‡ÐµÑ‚Ð°Ð½Ð¸Ðµ Ð´Ð°Ñ‘Ñ‚ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð±Ð°Ð»Ð°Ð½Ñ Ð¼ÐµÐ¶Ð´Ñƒ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒÑŽ, Ð¾Ñ‚ÐºÐ°Ð·Ð¾ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ð¾ÑÑ‚ÑŒÑŽ, ÐºÐ¾Ð½ÑÐ¸ÑÑ‚ÐµÐ½Ñ‚Ð½Ð¾ÑÑ‚ÑŒÑŽ Ð¸ Ð³Ð¸Ð±ÐºÐ¾ÑÑ‚ÑŒÑŽ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ.

---

Ð•ÑÐ»Ð¸ Ñ…Ð¾Ñ‡ÐµÑˆÑŒ â€” Ð¼Ð¾Ð³Ñƒ:

- ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ ÐºÑ€Ð°ÑÐ¸Ð²ÑƒÑŽ ASCII-Ð´Ð¸Ð°Ð³Ñ€Ð°Ð¼Ð¼Ñƒ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹,
- Ð¸Ð»Ð¸ Ð½Ð°Ð¿Ð¸ÑÐ°Ñ‚ÑŒ Ð¾Ñ„Ð¸Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ "Replication Architecture Design" Ð´Ð»Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹.

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ€ÐµÐ¿Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸

```shell
docker compose down
```

```shell
docker volume rm -f \
  db-indiv_moldova_data \
  db-indiv_romania_data \
  db-indiv_bulgaria_data \
  db-indiv_moldova_replica_data \
  db-indiv_romania_replica_data \
  db-indiv_bulgaria_replica_data
```

```shell
docker compose up -d db_moldova && docker compose logs -f db_moldova
```

ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° (`database system is ready to accept connections`) Ð²Ñ‹Ñ…Ð¾Ð´Ð¸Ð¼ Ð¸Ð· Ð»Ð¾Ð³Ð¾Ð² Ctrl+C

```shell
docker compose exec -it db_moldova bash -c "echo 'host replication replicator 0.0.0.0/0 md5' >> /var/lib/postgresql/data/pg_hba.conf"
```

```shell
docker compose down && docker compose up -d db_moldova db_romania db_bulgaria && docker compose logs -f db_bulgaria
```

ÐŸÐ¾ÑÐ»Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ° (
`logical replication table synchronization worker for subscription ... has finished`) Ð²Ñ‹Ñ…Ð¾Ð´Ð¸Ð¼ Ð¸Ð· Ð»Ð¾Ð³Ð¾Ð² Ctrl+C

```shell
docker compose exec -it db_romania bash -c "echo 'host replication replicator 0.0.0.0/0 md5' >> /var/lib/postgresql/data/pg_hba.conf"
```

```shell
docker compose exec -it db_bulgaria bash -c "echo 'host replication replicator 0.0.0.0/0 md5' >> /var/lib/postgresql/data/pg_hba.conf"
```

```shell
docker compose down && docker compose up -d
```